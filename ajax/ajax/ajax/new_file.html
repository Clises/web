<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<link rel="stylesheet" type="text/css" href="AjaxPaging.css" />
	</head>

	<body>
		<div class="wrap flex_column">
			<div class="content flex_column">
			</div>
			<div class="page">
				<ul class="flex_row">
					<li>1</li>
					<li>2</li>
					<li>3</li>
					<li>4</li>
					<li>5</li>
					<li>6</li>
				</ul>
			</div>
		</div>
		<!--
需求分析

		1. 数据获取组件
		2. 数据渲染DOM组件
			jsonDOM解析
				json格式的数据 渲染到DOM元素上
				1. 模板
				2. 数据绑定
				3. 替换content内容
		3. 分页业务实现
				1. 事件代理 != 事件绑定
				2. 改变page
				3. 拉取数据 - >渲染数据
		4. 缓存代理业务实现
				1. 渲染过的数据要存储
	
-->
		<!--
	ajax数据交互
	数据接口地址：
	设置参数
	账号密码请求的页数请求数据数量
	数据交互模式  GET post async
	检测数据通道状态
	获取数据
	检测数据通道状态
	0 未初始化
	1 调用了send（）正在发送的请求
	2 send载入完成
	3解析响应内容
	4响应内容解析完成 数据开始回调 客户端可以调用数据
	
-->
	</body>
	<script type="text/javascript">
		/***********连接接口***************/
		var url = 'https://route.showapi.com/181-1?'; //常量
		var oCon = document.querySelector('.content'); //获取content 
		var oUl = document.querySelector('.flex_row'); //用事件监听来写
		var page = 1; //初始化页码
		var cache = {}; //缓存池 没有length属性
		oUl.addEventListener('click', pageList, false);

		function pageList(e) {
			if(e.target.tagName.toLowerCase() == 'li') {
				page = e.target.innerHTML * 1; //点击获取对应的源码
				if(page in cache) { //判断json中是否有
					showPage(cache[page])
				} else {
					getJson()
				}

			}
		}
		//获取json
		getJson()

		function getJson() { //获取数据组件
			var xmlHttp = new XMLHttpRequest() //创建ajax对象
			var params = []; //数据中转数组
			//开启数据通道
			var sendData = {
				'showapi_appid': '30603', //账号
				'showapi_sign': '98960666afeb4992ae91971d13494090', //密码
				'page': page, //第几页数据
				'num': 8 //几条数据
			}

			for(var key in sendData) {
				//	  	console.log(key,sendData[key])  对应的value值
				params.push(key + '=' + sendData[key])
			}
			var postData = params.join('&') //以&为拼接符号拼接数组内容
			//key=value 
			xmlHttp.open('GET', url + postData, true)
			//提交请求
			xmlHttp.send(null);
			//反馈 
			//监听数据通道的变化
			xmlHttp.onreadystatechange = function() {
				//状态一切良好
				if(xmlHttp.readyState == 4 && xmlHttp.status == 200) {
					//格式化数据
					var dataList = JSON.parse(xmlHttp.response).showapi_res_body.newslist; //格式化数据 数组
					console.log(dataList)
					cache[page] = dataList; //缓存数据
					showPage(dataList); //调用渲染数据
				}
			}
		}
		//数据渲染组件
		function showPage(data) {
			console.log(data) //8条数据 数组 
			var len = data.length; //长度预存
			var str = ''; //初始化模板
			for(var i = 0; i < len; i++) {
				/*str +=
					`
		<a href="${data[i].url}" class="items flex_row load">
		 <div class="img"><img	src="${data[i].picUrl}"		alt=""></div>
			<div class="bd">
		 <p class="label">${data[i].title}</p>
			</div>
			  <div class="ft">&GT;</div>
		  </a>
		`*/
			}
			//渲染到ocon上
			oCon.innerHTML = str; //更改oCon的内容为str
			console.timeEnd('正在拉取数据');
		}
		var aLi = document.querySelectorAll('li')

		function forEach(eles, cb) { // each 发生闭包
			for(var i = 0, len = eles.length; i < len; i++) {
				cb && cb(eles[i], i);
			}
		}

		forEach(aLi, function(obj, idx) {
			obj.style.border = idx + 'px solid red';
		})
	</script>

</html>

<!--
	var json={
		name:'嗨呀'，
		age：13，
		job:'工程师'
	}
	json字符串的添加
	json['assad']=true;
	json.flog=true;
	console.log(json.name)  //获取json名
-->